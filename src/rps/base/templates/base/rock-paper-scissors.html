<template>
  <div>
    <video id="webcam" width="640" height="480" autoplay></video>
    <button id="play-button" onclick="play()">Play</button>
  </div>
</template>

<script>
  // Function to start the webcam and display the video feed
  function startWebcam() {
    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
      .then(function(stream) {
        var video = document.getElementById('webcam');
        video.srcObject = stream;
        video.play();
      })
      .catch(function(err) {
        console.log("An error occurred: " + err);
      });
  }

  // Function to capture the image from the webcam and send it to the Django view
  function play() {
    // Stop the video stream from the webcam
    var video = document.getElementById('webcam');
    var stream = video.srcObject;
    var tracks = stream.getTracks();

    for (var i = 0; i < tracks.length; i++) {
      var track = tracks[i];
      track.stop();
    }

    // Create a canvas element to draw the image on
    var canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Convert the image to a data URL
    var imageData = canvas.toDataURL('image/jpeg');

    // Send the image to the Django view using an AJAX request
    $.ajax({
      type: 'POST',
      url: '{% url 'process_image' %}',
      data: {
        csrfmiddlewaretoken: '{{ csrf_token }}',
        image_data: imageData,
      },
      success: function(response) {
        // Process the response from the view (e.g., play the rock-paper-scissors game)
      },
      error: function(xhr, status, error) {
        console.log(error);
      }
    });
  }

  // Start the webcam when the template is loaded
  $(document).ready(function() {
    startWebcam();
  });
</script>
